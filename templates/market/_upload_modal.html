<div id="upload-modal" class="modal" hidden>
  <div class="modal-box">
    <button class="modal-close" aria-label="Close" data-close>&times;</button>
    <h3>{{ _('Додати модель') }}</h3>

    <form id="upload-form" method="post" enctype="multipart/form-data" action="/api/market/upload">
      <label>{{ _('Назва') }}
        <input type="text" name="title" required>
      </label>

      <label>{{ _('Опис') }}
        <textarea name="description" rows="4"></textarea>
      </label>

      <label>{{ _('Категорія') }}
        <select name="category_slug">
          <option value="">{{ _('Без категорії') }}</option>
          {% for c in (g.market_categories or []) %}
            <option value="{{ c.slug }}">{{ c.name }}</option>
          {% endfor %}
        </select>
      </label>

      <label class="drop">
        {{ _('Головний файл моделі (STL/OBJ/GLTF/ZIP)') }}
        <input type="file" name="file" accept=".stl,.obj,.gltf,.glb,.zip" required>
      </label>

      <label class="drop">
        {{ _('Обкладинка (зображення)') }}
        <input type="file" name="cover" accept="image/*">
      </label>

      <label class="row">
        <input type="checkbox" name="is_free" value="1" id="is_free" checked>
        <span>{{ _('Безкоштовно') }}</span>
      </label>

      <div class="row price-row" id="price_row" hidden>
        <label style="display:flex;gap:8px;align-items:center">
          <span>{{ _('Ціна (у центах)') }}</span>
          <input type="number" min="0" step="1" name="price_cents" placeholder="500">
        </label>
      </div>

      <div class="actions">
        <button class="btn" type="button" data-close>{{ _('Скасувати') }}</button>
        <button class="btn primary" type="submit">{{ _('Завантажити') }}</button>
      </div>
    </form>
  </div>
</div>

<script>
  (function(){
    const modal = document.getElementById('upload-modal');
    const openBtn = document.getElementById('btn-upload');
    const priceRow = document.getElementById('price_row');
    const isFree = document.getElementById('is_free');

    function open(){ modal.hidden = false; document.body.style.overflow = 'hidden'; }
    function close(){ modal.hidden = true; document.body.style.overflow = ''; }

    document.addEventListener('click', (e)=>{
      if (e.target.matches('[data-close]') || e.target.classList.contains('modal')) close();
    });
    if (openBtn){ openBtn.addEventListener('click', (e)=>{ e.preventDefault(); open(); }); }

    if (isFree){
      const sync = ()=>{ priceRow.hidden = isFree.checked; };
      isFree.addEventListener('change', sync); sync();
    }
  })();
</script>

<style>
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:block}
.modal[hidden]{display:none}
.modal-box{
  width:min(680px, 92vw);
  margin:6vh auto; background:var(--card);
  border:1px solid var(--line); border-radius:12px; padding:16px;
  color:var(--text); position:relative;
}
.modal-close{
  position:absolute; right:10px; top:8px;
  background:transparent; border:none; color:var(--text);
  font-size:22px; cursor:pointer;
}
label{display:flex;flex-direction:column;gap:6px;margin:8px 0}
input[type="text"], textarea, select, input[type="number"]{
  background:transparent; border:1px solid var(--line);
  color:var(--text); border-radius:10px; padding:8px 10px; outline:none;
}
.drop{
  border:1px dashed var(--line); border-radius:10px; padding:10px;
}
.row{display:flex;gap:8px;align-items:center}
.actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
.btn{
  background:var(--card);border:1px solid var(--line);color:var(--text);
  padding:8px 12px;border-radius:10px;cursor:pointer
}
.btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
</style>
