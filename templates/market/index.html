{% extends "base.html" %}
{% block content %}

<div class="wrap">
  <header>
    <div class="brand">üß© STL Market</div>

    <div class="search-box">
      <input id="q" placeholder="–ü–æ—à—É–∫: dragon, stand, toy..." />
      <button class="btn" id="btnSearch">üîç</button>
    </div>

    <div class="toolbar">  
      <button class="btn" id="btnMine" title="–ü–æ–∫–∞–∑–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –º–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è">–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</button>
      <a href="{{ url_for('market.page_upload') }}" class="btn primary">+ –î–æ–¥–∞—Ç–∏ –º–æ–¥–µ–ª—å</a>
    </div>
  </header>

  <div class="explore-tags">
    <button class="tag-btn" data-cat="all" class="active">üî• –ü–æ–ø—É–ª—è—Ä–Ω–µ</button>
    <button class="tag-btn" data-cat="new">üÜï –ù–æ–≤—ñ</button>
    <button class="tag-btn" data-cat="free">üü¢ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ</button>
    <button class="tag-btn" data-cat="paid">üí∞ –ü–ª–∞—Ç–Ω—ñ</button>
    <button class="tag-btn" data-cat="anime">üéå –ê–Ω—ñ–º–µ</button>
    <button class="tag-btn" data-cat="toys">üêâ –Ü–≥—Ä–∞—à–∫–∏</button>
    <button class="tag-btn" data-cat="useful">üß† –ö–æ—Ä–∏—Å–Ω–µ</button>
  </div>

  <div class="controls">
    <label>–ü–æ–∫–∞–∑–∞—Ç–∏:
      <select id="filterFree">
        <option value="all">–£—Å—ñ</option>
        <option value="free">–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ</option>
        <option value="paid">–ü–ª–∞—Ç–Ω—ñ</option>
      </select>
    </label>
    <label>–°–æ—Ä—Ç—É–≤–∞—Ç–∏:
      <select id="sort">
        <option value="new">–ù–æ–≤—ñ</option>
        <option value="price_asc">–¶—ñ–Ω–∞ ‚Üë</option>
        <option value="price_desc">–¶—ñ–Ω–∞ ‚Üì</option>
        <option value="downloads">–ü–æ–ø—É–ª—è—Ä–Ω—ñ</option>
      </select>
    </label>
  </div>

  <div id="notice" class="notice" style="display:none"></div>

  <div id="grid" class="grid"></div>
  <div id="sentinel" class="sentinel"></div>
</div>

<style>
  :root {
    --bg:#0f1116; --card:#141923; --muted:#8792a7;
    --line:#232a3a; --text:#e7ebf4; --accent:#3b82f6; --danger:#ef4444;
  }
  .wrap{max-width:1280px;margin:0 auto;padding:16px;}
  header{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:12px;}
  .brand{font-weight:800;font-size:18px;letter-spacing:.3px;}
  .search-box{flex:1;display:flex;gap:8px;background:var(--card);border:1px solid var(--line);border-radius:10px;padding:6px;}
  .search-box input{flex:1;background:transparent;border:none;color:var(--text);font-size:14px;outline:none;}
  .toolbar{display:flex;gap:8px}
  .btn{background:var(--card);border:1px solid var(--line);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent);}
  .btn:active{transform:scale(.98);}
  .btn.danger{border-color:var(--danger); color:#fff; background:var(--danger);}
  .btn.ghost{opacity:.85}
  .btn.active{outline:2px solid var(--accent)}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;}
  select{background:var(--card);border:1px solid var(--line);border-radius:10px;color:var(--text);padding:8px 10px;}

  .explore-tags{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin:10px 0 14px 0;
  }
  .tag-btn{
    background:var(--card);
    color:var(--text);
    border:1px solid var(--line);
    border-radius:20px;
    padding:6px 12px;
    font-size:13px;
    cursor:pointer;
    transition:all .2s;
  }
  .tag-btn:hover{background:var(--accent);color:#fff;}
  .tag-btn.active{background:var(--accent);color:#fff;box-shadow:0 0 10px rgba(59,130,246,.5);}

  .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));}
  @media(max-width:1100px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
  @media(max-width:700px){ .grid{grid-template-columns:1fr;} }

  .item{background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;transition:transform .15s;}
  .item:hover{transform:translateY(-2px);}

  .thumb-wrap{position:relative;width:100%;padding-top:66.666%; background:#0c0f16;border-bottom:1px solid var(--line);cursor:pointer;}
  .thumb{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;}

  .meta{padding:12px;display:flex;flex-direction:column;gap:6px;}
  .title{font-weight:700;}
  .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:2px;}
  .tag{font-size:12px;border:1px solid var(--line);padding:2px 6px;border-radius:999px;color:var(--muted);}
  .muted{color:var(--muted);font-size:13px;}
  .price{font-weight:700;}
  .actions{margin-top:6px;display:flex;gap:8px;flex-wrap:wrap}
  .empty{text-align:center;color:var(--muted);padding:20px;}
  .notice{margin:8px 0;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:var(--card);color:var(--text);}
  .sentinel{height:1px}
</style>

<!-- –Ω–µ–≤–µ–ª–∏—á–∫–∏–π –ø—Ä–∞–ø–æ—Ä —Ç–∏–ø—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ -->
<script>
  document.addEventListener('DOMContentLoaded', function(){
    document.body.dataset.marketPage = 'list';

    const tagButtons = document.querySelectorAll('.tag-btn');
    tagButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        tagButtons.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const cat = btn.dataset.cat;
        document.dispatchEvent(new CustomEvent('marketCategoryChange', { detail: cat }));
      });
    });
  });
</script>

<!-- —Ä–µ—à—Ç–∞ JS —è–∫ —É —Ç–µ–±–µ -->
{{ super() }}
{% endblock %}
