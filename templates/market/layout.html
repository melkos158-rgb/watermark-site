{% extends "base.html" %}

{% block extra_head %}
  {{ super() }}
  {# Головні стилі маркету - з cache busting #}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/market_cards.css', v=asset_v) }}">
  {# якщо є ще окремий файл для загального оформлення маркету #}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/market.css', v=asset_v) }}">
{% endblock %}

{% block content %}
  {# можна задати тип сторінки з дочірнього шаблону: {% set market_page = 'list' or 'detail' or 'my' %} #}
  <div class="market-wrap">
    {# верхня підшапка показується тільки якщо це НЕ головний список (/market) #}
    {% if market_page != 'list' %}
      {% include "market/_subheader.html" %}
    {% endif %}
    <div class="market-body">{% block market_body %}{% endblock %}</div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!-- Виставляємо data-атрибут + класи на body для трекінгу типу сторінки -->
  <script>
    (function(){
      try {
        var t = {{ (market_page or 'list')|tojson }};
        document.addEventListener('DOMContentLoaded', function(){
          var b = document.body;
          if (!b) return;
          b.dataset.marketPage = t;
          b.classList.add('market-page');
          if (t) {
            b.classList.add('market-page-' + t);
            // окремий клас для сторінки "Мої оголошення"
            if (t === 'my') {
              b.classList.add('my-market-page');
            }
          }
        });
      } catch(e) {}
    })();
  </script>

  {# базове API + фільтри, завантаження, перегляд, оплата, аналітика - з cache busting #}
  <script type="module" src="{{ url_for('static', filename='market/js/api.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/filters.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/uploader.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/viewer.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/favorites.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/reviews.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/checkout.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/analytics.js', v=asset_v) }}"></script>

  {# рекомендації + основна логіка маркету #}
  <script type="module" src="{{ url_for('static', filename='market/js/recommend.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/market.js', v=asset_v) }}"></script>

  {# глобальні слухачі, пошук, підказки, related, категорії #}
  <script type="module" src="{{ url_for('static', filename='market/js/market_listeners.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/search.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/suggest.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/related.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/categories.js', v=asset_v) }}"></script>

  {# нотифікації, бандли, профілі принтерів, параметричні моделі, перевірка друкованості #}
  <script type="module" src="{{ url_for('static', filename='market/js/notifications.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/bundle_cart.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/printer_profiles.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/parametric_ui.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/printability_check.js') }}"></script>

  {# G-code інструменти + статистика #}
  <script type="module" src="{{ url_for('static', filename='market/js/gcode_viewer.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/stats_charts.js') }}"></script>

  {# AI-інструменти (дашборд і окремі тулзи) #}
  <script type="module" src="{{ url_for('static', filename='market/js/ai_tools.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/dashboard_ai_tools.js') }}"></script>
{% endblock %}
