{% extends "base.html" %}

{% block extra_head %}
  {{ super() }}
  {# –ì–æ–ª–æ–≤–Ω—ñ —Å—Ç–∏–ª—ñ –º–∞—Ä–∫–µ—Ç—É - –∑ cache busting #}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/market_cards.css', v=asset_v) }}">
  {# —è–∫—â–æ —î —â–µ –æ–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ç—É #}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/market.css', v=asset_v) }}">
{% endblock %}

{% block content %}
  {# –º–æ–∂–Ω–∞ –∑–∞–¥–∞—Ç–∏ —Ç–∏–ø —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ —à–∞–±–ª–æ–Ω—É: {% set market_page = 'list' or 'detail' or 'my' %} #}
  <div class="market-wrap">
    {# –≤–µ—Ä—Ö–Ω—è –ø—ñ–¥—à–∞–ø–∫–∞ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ü–µ –ù–ï –≥–æ–ª–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ (/market) #}
    {% if market_page != 'list' %}
      {% include "market/_subheader.html" %}
    {% endif %}
    <div class="market-body">{% block market_body %}{% endblock %}</div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!-- –í–∏—Å—Ç–∞–≤–ª—è—î–º–æ data-–∞—Ç—Ä–∏–±—É—Ç + –∫–ª–∞—Å–∏ –Ω–∞ body –¥–ª—è —Ç—Ä–µ–∫—ñ–Ω–≥—É —Ç–∏–ø—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
  <script>
    (function(){
      try {
        var t = {{ (market_page or 'list')|tojson }};
        document.addEventListener('DOMContentLoaded', function(){
          var b = document.body;
          if (!b) return;
          b.dataset.marketPage = t;
          b.classList.add('market-page');
          if (t) {
            b.classList.add('market-page-' + t);
            // –æ–∫—Ä–µ–º–∏–π –∫–ª–∞—Å –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ "–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è"
            if (t === 'my') {
              b.classList.add('my-market-page');
            }
          }
        });
      } catch(e) {}
    })();
  </script>

  {# –±–∞–∑–æ–≤–µ API + —Ñ—ñ–ª—å—Ç—Ä–∏, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –ø–µ—Ä–µ–≥–ª—è–¥, –æ–ø–ª–∞—Ç–∞, –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ - –∑ cache busting #}
  <script type="module" src="{{ url_for('static', filename='market/js/api.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/filters.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/uploader.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/viewer.js', v=asset_v) }}"></script>
  
  {# üé¨ Cults-style video preview on cards #}
  <script defer src="{{ url_for('static', filename='market/js/video_preview.js', v=asset_v) }}"></script>
  
  {# LEGACY: favorites.js —Ç–µ–ø–µ—Ä –∫–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ market_listeners.js #}
  {# <script type="module" src="{{ url_for('static', filename='market/js/favorites.js', v=asset_v) }}"></script> #}
  <script type="module" src="{{ url_for('static', filename='market/js/reviews.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/checkout.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/analytics.js', v=asset_v) }}"></script>

  {# —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó + –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –º–∞—Ä–∫–µ—Ç—É #}
  <script type="module" src="{{ url_for('static', filename='market/js/recommend.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/market.js', v=asset_v) }}"></script>

  {# –≥–ª–æ–±–∞–ª—å–Ω—ñ —Å–ª—É—Ö–∞—á—ñ, –ø–æ—à—É–∫, –ø—ñ–¥–∫–∞–∑–∫–∏, related, –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó #}
  <script type="module" src="{{ url_for('static', filename='market/js/market_listeners.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/search.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/suggest.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/related.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/categories.js', v=asset_v) }}"></script>

  {# –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó, –±–∞–Ω–¥–ª–∏, –ø—Ä–æ—Ñ—ñ–ª—ñ –ø—Ä–∏–Ω—Ç–µ—Ä—ñ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—ñ –º–æ–¥–µ–ª—ñ, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—Ä—É–∫–æ–≤–∞–Ω–æ—Å—Ç—ñ #}
  <script type="module" src="{{ url_for('static', filename='market/js/notifications.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/bundle_cart.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/printer_profiles.js', v=asset_v) }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/parametric_ui.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/printability_check.js') }}"></script>

  {# G-code —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ #}
  <script type="module" src="{{ url_for('static', filename='market/js/gcode_viewer.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/stats_charts.js') }}"></script>

  {# AI-—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ (–¥–∞—à–±–æ—Ä–¥ —ñ –æ–∫—Ä–µ–º—ñ —Ç—É–ª–∑–∏) #}
  <script type="module" src="{{ url_for('static', filename='market/js/ai_tools.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/dashboard_ai_tools.js') }}"></script>
{% endblock %}
