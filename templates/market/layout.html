{% extends "base.html" %}

{% block content %}
  {# можна задати тип сторінки з дочірнього шаблону: {% set market_page = 'list' or 'detail' or 'my' %} #}
  <div class="market-wrap">
    {% include "market/_subheader.html" %}
    <div class="market-body">{% block market_body %}{% endblock %}</div>
  </div>
{% endblock %}

{% block scripts %}
  <!-- Виставляємо data-атрибут для трекінгу типу сторінки -->
  <script>
    (function(){
      try {
        var t = {{ (market_page or 'list')|tojson }};
        document.addEventListener('DOMContentLoaded', function(){
          document.body.dataset.marketPage = t;
        });
      } catch(e) {}
    })();
  </script>

  <!-- Підключай ІЗ static/, не з templates/ -->

  {# базове API + фільтри, завантаження, перегляд, оплата, аналітика #}
  <script type="module" src="{{ url_for('static', filename='market/js/api.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/filters.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/uploader.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/viewer.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/favorites.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/reviews.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/checkout.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/analytics.js') }}"></script>

  {# рекомендації + основна логіка маркету #}
  <script type="module" src="{{ url_for('static', filename='market/js/recommend.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/market.js') }}"></script>

  {# глобальні слухачі, пошук, підказки, related, категорії #}
  <script type="module" src="{{ url_for('static', filename='market/js/market_listeners.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/search.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/suggest.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/related.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/categories.js') }}"></script>

  {# нотифікації, бандли, профілі принтерів, параметричні моделі, перевірка друкованості #}
  <script type="module" src="{{ url_for('static', filename='market/js/notifications.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/bundle_cart.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/printer_profiles.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/parametric_ui.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/printability_check.js') }}"></script>

  {# G-code інструменти + статистика #}
  <script type="module" src="{{ url_for('static', filename='market/js/gcode_viewer.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/stats_charts.js') }}"></script>

  {# AI-інструменти (дашборд і окремі тулзи) #}
  <script type="module" src="{{ url_for('static', filename='market/js/ai_tools.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='market/js/dashboard_ai_tools.js') }}"></script>
{% endblock %}
