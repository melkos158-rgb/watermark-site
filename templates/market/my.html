{% extends "base.html" %}

{% block title %}–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è ‚Äî Proofly STL Market{% endblock %}

{% block content %}
{# Macro to get thumbnail URL with fallbacks #}
{% macro get_thumbnail(ad) -%}
  {%- if ad.thumbnail -%}
    {{ ad.thumbnail }}
  {%- elif ad.thumb -%}
    {{ ad.thumb }}
  {%- elif ad.image -%}
    {{ ad.image }}
  {%- elif ad.cover -%}
    {{ ad.cover }}
  {%- else -%}
    /static/img/placeholder_stl.jpg
  {%- endif -%}
{%- endmacro %}

{# Get ads list with fallback chain #}
{% set ads_list = my_ads if my_ads is defined else (ads if ads is defined else (user_ads if user_ads is defined else [])) %}

<div class="market-page my-market-page" data-market-root data-market-page="my">

  {% if ads_list %}
    <!-- üéû –ö–∞—Ä—É—Å–µ–ª—å –∑ 3D-–ø—Ä–µ–≤ º—é -->
    <section id="my-carousel" class="my-carousel" data-items-count="{{ ads_list|length }}">
      <button class="mc-arrow mc-arrow-left" type="button" data-dir="prev" aria-label="–ü–æ–ø–µ—Ä–µ–¥–Ω—è –º–æ–¥–µ–ª—å">
        ‚Äπ
      </button>

      <div class="mc-strip">
        <!-- Server-rendered carousel items (hidden by default, JS will show active ones) -->
        {% for ad in ads_list %}
          <div class="mc-carousel-item" data-item-index="{{ loop.index0 }}" data-item-id="{{ ad.id }}" style="display: none;">
            <img src="{{ get_thumbnail(ad) }}" alt="{{ ad.title }}" class="mc-item-thumb" />
            <div class="mc-item-title">{{ ad.title }}</div>
            <div class="mc-item-price">{{ ad.price }} ‚Ç¥</div>
            <a href="{{ url_for('market.page_edit_item', item_id=ad.id) }}" class="mc-item-edit">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
          </div>
        {% endfor %}

        <!-- Display cards (populated by JS) -->
        <div class="mc-card mc-card-side" id="mc-left-card">
          <div class="mc-thumb" data-role="thumb"></div>
          <div class="mc-title" data-role="title"></div>
        </div>

        <div class="mc-card mc-card-main" id="mc-main-card">
          <div class="mc-thumb" data-role="thumb"></div>
          <div class="mc-title" data-role="title"></div>
          <a id="mc-edit-btn" class="mc-edit-btn" href="#" aria-label="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è">
            –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
          </a>
        </div>

        <div class="mc-card mc-card-side" id="mc-right-card">
          <div class="mc-thumb" data-role="thumb"></div>
          <div class="mc-title" data-role="title"></div>
        </div>
      </div>

      <button class="mc-arrow mc-arrow-right" type="button" data-dir="next" aria-label="–ù–∞—Å—Ç—É–ø–Ω–∞ –º–æ–¥–µ–ª—å">
        ‚Ä∫
      </button>
    </section>

    <!-- üß± –ì—Ä—ñ–¥ ¬´–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è¬ª -->
    <section class="my-grid-section">
      <h2 class="my-grid-title">–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h2>

      <div class="my-grid" id="my-grid">
        {% for ad in ads_list %}
          <div class="my-grid-item" data-ad-id="{{ ad.id }}">
            <div class="my-grid-thumb" style="background-image: url('{{ get_thumbnail(ad) }}');"></div>
            <div class="my-grid-info">
              <h3 class="my-grid-item-title">{{ ad.title }}</h3>
              <p class="my-grid-item-price">{{ ad.price }} ‚Ç¥</p>
              <a href="{{ url_for('market.page_edit_item', item_id=ad.id) }}" class="my-grid-edit-btn">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </section>

  {% else %}
    <!-- Empty state -->
    <div class="my-empty-state">
      <p class="my-empty-message">–ü–æ–∫–∏ —â–µ –Ω–µ–º–∞—î –º–æ–¥–µ–ª–µ–π‚Ä¶</p>
    </div>
  {% endif %}

</div>

{# –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ —Å—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ #}
<link rel="stylesheet" href="{{ url_for('static', filename='css/my-ads.css') }}">
<script src="{{ url_for('static', filename='js/my-ads.js') }}"></script>
{% endblock %}
