{% extends "base.html" %}

{% block title %}–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è ‚Äî Proofly STL Market{% endblock %}

{% block content %}
<div class="market-page my-market-page" data-market-root data-market-page="my">

  <!-- üîç –ü–æ—à—É–∫ –∑–≤–µ—Ä—Ö—É -->
  <section class="my-search-section">
    <form id="my-search-form"
          class="my-search-form"
          action="{{ url_for('market.page_market', owner=request.args.get('owner', 'me')) }}"
          method="get"
          role="search"
          aria-label="–ü–æ—à—É–∫ –ø–æ –º–æ—ó—Ö –º–æ–¥–µ–ª—è—Ö">
      <input id="my-search-input"
             type="search"
             name="q"
             placeholder="–ü–æ—à—É–∫"
             value="{{ request.args.get('q', '') }}">
      <button type="submit">–ü–æ—à—É–∫</button>
    </form>
  </section>

  {# –ó–º—ñ–Ω–Ω–∞ –∑ –º–æ–¥–µ–ª—è–º–∏ –≤–ª–∞—Å–Ω–∏–∫–∞. –ü—ñ–¥—Ç—è–≥—É—î–º–æ –∑ —Ä—ñ–∑–Ω–∏—Ö –º–æ–∂–ª–∏–≤–∏—Ö –Ω–∞–∑–≤. #}
  {% set items =
        my_items if my_items is defined else
        user_items if user_items is defined else
        models if models is defined else
        listings if listings is defined else
        market_items if market_items is defined else
        items if items is defined else [] %}

  <!-- üéû –ö–∞—Ä—É—Å–µ–ª—å –∑ 3D-–ø—Ä–µ–≤ º—é -->
  <section id="my-carousel" class="my-carousel"
           data-items-count="{{ items|length }}">
    {% if items %}
      <button class="mc-arrow mc-arrow-left" type="button" data-dir="prev" aria-label="–ü–æ–ø–µ—Ä–µ–¥–Ω—è –º–æ–¥–µ–ª—å">
        ‚Äπ
      </button>

      <div class="mc-strip">
        <!-- –õ—ñ–≤–µ –º–∞–ª–µ–Ω—å–∫–µ –ø—Ä–µ–≤ º—é -->
        <div class="mc-card mc-card-side" id="mc-left-card">
          <div class="mc-thumb" data-role="thumb"></div>
          <div class="mc-title" data-role="title"></div>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–µ –≤–µ–ª–∏–∫–µ –ø—Ä–µ–≤ º—é -->
        <div class="mc-card mc-card-main" id="mc-main-card">
          <div class="mc-thumb" data-role="thumb"></div>
          <div class="mc-title" data-role="title"></div>
          <a id="mc-edit-btn"
             class="mc-edit-btn"
             href="#"
             aria-label="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è">
            –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
          </a>
        </div>

        <!-- –ü—Ä–∞–≤–µ –º–∞–ª–µ–Ω—å–∫–µ –ø—Ä–µ–≤ º—é -->
        <div class="mc-card mc-card-side" id="mc-right-card">
          <div class="mc-thumb" data-role="thumb"></div>
          <div class="mc-title" data-role="title"></div>
        </div>
      </div>

      <button class="mc-arrow mc-arrow-right" type="button" data-dir="next" aria-label="–ù–∞—Å—Ç—É–ø–Ω–∞ –º–æ–¥–µ–ª—å">
        ‚Ä∫
      </button>

      {# JSON –∑ –¥–∞–Ω–∏–º–∏ –ø—Ä–æ –º–æ–¥–µ–ª—ñ –¥–ª—è JS #}
      <script id="my-carousel-data" type="application/json">
        {{ items|map(attribute="to_dict")|list|tojson }}
      </script>

    {% else %}
      <div class="mc-empty">
        –£ —Ç–µ–±–µ —â–µ –Ω–µ–º–∞—î –æ–≥–æ–ª–æ—à–µ–Ω—å. –î–æ–¥–∞–π –ø–µ—Ä—à—É –º–æ–¥–µ–ª—å, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∫–∞—Ä—É—Å–µ–ª—å üòé
      </div>
    {% endif %}
  </section>

  <!-- üß± –ì—Ä—ñ–¥ ¬´–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è¬ª -->
  <section class="my-grid-section">
    <h2 class="my-grid-title">–ú–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h2>

    {% if items %}
      <div class="my-grid">
        {% for item in items %}
          <article class="my-grid-item"
                   data-item-index="{{ loop.index0 }}"
                   data-item-id="{{ item.id }}">
            <a class="my-grid-thumb-link"
               href="{{ url_for('market.item_page', item_id=item.id) }}"
               title="{{ item.title }}">
              <div class="my-grid-thumb"
                   style="background-image: url('{{ item.cover_url or item.preview_url or url_for('static', filename='img/placeholder.png') }}');">
              </div>
            </a>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="my-grid-empty">
        –ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –º–æ–¥–µ–ª–µ–π. –Ø–∫ —Ç—ñ–ª—å–∫–∏ –¥–æ–¥–∞—Å–∏ ‚Äî –≤–æ–Ω–∏ –∑ º—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç —É –≤–∏–≥–ª—è–¥—ñ —Å—ñ—Ç–∫–∏.
      </p>
    {% endif %}
  </section>
</div>

{# –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ JS –¥–ª—è –∫–∞—Ä—É—Å–µ–ª—ñ #}
<script src="{{ url_for('static', filename='js/market_my.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/market_my.css') }}">
{% endblock %}
