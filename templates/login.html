{% extends "base.html" %}
{% block content %}
<div class="auth-card">
  <h2>Увійти</h2>

  <!-- Локальний логін -->
  <form method="post" action="{{ url_for('login_local') }}">
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Пароль" required>
    <button type="submit">Увійти</button>
  </form>

  <div class="divider">або</div>

  <!-- ДОДАНО: окремий вхід за кодом користувача -->
  <form method="post" action="{{ url_for('login_local') }}" class="code-login">
    <input type="text" name="code" placeholder="Код користувача (наприклад: 7K4M9XQZ2D1L8R3T)">
    <button type="submit">Увійти за кодом</button>
  </form>

  <div class="divider">або</div>

  <!-- Соц-входи -->
  <a class="btn oauth google" href="{{ url_for('login_google') }}">Увійти через Google</a>
  <a class="btn oauth apple" href="#">Увійти через Apple (скоро)</a>

  <p class="muted">
    Немає акаунта? <a href="{{ url_for('register') }}" class="reg-link">Зареєструватися</a>
    <br>
    <small>Порада: після реєстрації ти отримаєш свій довгий код — ним можна входити без пароля.</small>
  </p>
</div>

<style>
.auth-card{max-width:520px;margin:32px auto;padding:24px;background:#fff;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
.auth-card h2{margin:0 0 12px}
.auth-card form{display:grid;gap:12px;margin-bottom:12px}
.auth-card input{height:42px;padding:0 12px;border:1px solid #e5e7eb;border-radius:10px}
.auth-card button{height:42px;border:0;border-radius:10px;background:#4f46e5;color:#fff;font-weight:700;cursor:pointer}
.divider{text-align:center;margin:12px 0;color:#6b7280}
.btn.oauth{display:block;text-align:center;padding:12px 16px;border-radius:12px;text-decoration:none;font-weight:700;margin-top:10px}
.btn.oauth.google{background:#fff;border:1px solid #e5e7eb}
.btn.oauth.apple{background:#000;color:#fff}
.muted{color:#6b7280;margin-top:14px}
.flash .flash-item{background:#fee2e2;border:1px solid #fecaca;color:#991b1b;padding:10px;border-radius:10px;margin-bottom:8px}

/* ДОДАНО: стиль для форми входу за кодом */
.code-login input{letter-spacing:.05em;text-transform:uppercase}
</style>

<!-- ДОДАНО: автоповернення на сторінку 'next' після логіну/реєстрації -->
<script>
(function() {
  var params = new URLSearchParams(location.search);
  var next = params.get('next');
  if (!next) return;

  // додати ?next=... до обох форм login_local
  document.querySelectorAll('form[action$="{{ url_for("login_local") }}"]').forEach(function(f){
    try {
      var url = new URL(f.action, location.origin);
      url.searchParams.set('next', next);
      f.action = url.toString();
    } catch(e) {}
  });

  // додати ?next=... до посилання "Зареєструватися"
  var reg = document.querySelector('.reg-link');
  if (reg) {
    try {
      var u = new URL(reg.href, location.origin);
      u.searchParams.set('next', next);
      reg.href = u.toString();
    } catch(e) {}
  }

  // додати ?next=... до Google-логіну (щоб після OAuth теж вертало)
  var g = document.querySelector('.btn.oauth.google');
  if (g) {
    try {
      var ug = new URL(g.href, location.origin);
      ug.searchParams.set('next', next);
      g.href = ug.toString();
    } catch(e) {}
  }
})();
</script>
{% endblock %}


