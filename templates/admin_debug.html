<!DOCTYPE html>
<html><head><title>Debug Admin</title></head><body>
<h1>DEBUG REPORT</h1>
<div id="env">
  <h2>ENV</h2>
  {% for k,v in env.items() %}
    <div {% if not v %}style="color:red"{% endif %}>{{k}}: {{v or 'MISSING'}}</div>
  {% endfor %}
</div>
<div id="health">
  <h2>Health Checks</h2>
  {% for k,v in health.items() %}
    <div {% if v != 200 %}style="color:red"{% endif %}>{{k}}: {{v}}</div>
  {% endfor %}
</div>
<div id="backend-errors">
  <h2>Backend Errors</h2>
  {% for e in errors %}
    <div style="color:red">[{{e.ts}}] {{e.url}}: {{e.message}} ({{e.request_id}})</div>
  {% endfor %}
</div>
<div id="client-errors">
  <h2>Client JS Errors</h2>
  <pre id="js-errors" style="color:red"></pre>
</div>

<button id="copy-debug-report" style="font-size:2em;background:#faa">COPY FULL DEBUG REPORT</button>
<span id="copy-status" style="margin-left:1em"></span>
<br><br>
<textarea id="debug-report-box" style="width:100%;height:200px;font-size:1em"></textarea>
<script src="/static/js/debug.js"></script>
<script>
document.getElementById('copy-debug-report').onclick = async function() {
  const res = await fetch('/admin/debug/report.json');
  const data = await res.json();
  const text = JSON.stringify(data, null, 2);
  await navigator.clipboard.writeText(text);
  document.getElementById('copy-status').textContent = 'Copied âœ…';
  document.getElementById('debug-report-box').value = text;
};
// Load client errors
document.getElementById('js-errors').textContent = (window.__DEBUG_ERRORS__||[]).map(e=>JSON.stringify(e)).join('\n');
</script>
</body></html>
