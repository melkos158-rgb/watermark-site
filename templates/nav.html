<nav class="navbar">
  <div class="nav-wrap">
    <!-- Ğ‘Ğ£Ğ Ğ“Ğ•Ğ  (Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¸Ğ¹ Ğ»Ğ¸ÑˆĞµ Ğ½Ğ° Ğ¼Ğ¾Ğ±Ñ–Ğ»Ñ†Ñ–) -->
    <button class="burger" id="burger" aria-label="ĞœĞµĞ½Ñ" aria-expanded="false">â˜°</button>

    <!-- Ğ›ĞĞ“Ğ + ĞĞĞ—Ğ’Ğ -->
    <a href="{{ url_for('index') }}" class="brand" aria-label="ĞĞ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ñƒ">
      <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo">
      <span class="wordmark" aria-label="Proofly">Proofly</span>
    </a>

    <!-- Ğ›Ğ†Ğ’Ğ† ĞšĞĞĞŸĞšĞ˜ -->
    <a class="nav-btn {{ 'active' if request.endpoint=='index' else '' }}" href="{{ url_for('index') }}">Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°</a>
    <a class="nav-btn {{ 'active' if request.endpoint=='stl' else '' }}" href="{{ url_for('stl') }}">STL3D</a>
    <a class="nav-btn {{ 'active' if request.endpoint=='video' else '' }}" href="{{ url_for('video') }}">Video</a>

    <!-- DROPDOWN: Photo -->
    <div class="nav-dropdown" data-dd>
      <button
        class="nav-btn dd-trigger {{ 'active' if request.endpoint in ['photo','enhance','edit_photo'] else '' }}"
        type="button"
        aria-expanded="false"
      >
        Photo <span class="dd-caret" aria-hidden="true"></span>
      </button>
      <div class="dd-menu" role="menu">
        <a class="dd-item {{ 'active' if request.endpoint=='photo' else '' }}" href="{{ url_for('photo') }}">Photo â€” Gallery / Tools</a>
        <a class="dd-item {{ 'active' if request.endpoint=='enhance' else '' }}" href="{{ url_for('enhance') }}">Photo Enhance</a>
        <a class="dd-item {{ 'active' if request.endpoint=='edit_photo' else '' }}" href="{{ url_for('edit_photo') }}">Edit Photo</a>
      </div>
    </div>

    <!-- NEW: Documents -->
    <a class="nav-btn {{ 'active' if request.endpoint=='documents' else '' }}" href="{{ url_for('documents') }}">Documents</a>

    <a class="nav-btn {{ 'active' if (request.endpoint and request.endpoint=='market.page_market') else '' }}"
       href="{{ url_for('market.page_market') }}">Market</a>

    <!-- ĞŸĞ ĞĞ’Ğ˜Ğ™ Ğ‘Ğ›ĞĞš -->
    <div class="nav-right" style="display:flex; align-items:center; gap:10px; margin-left:auto">
      <select id="themeSelect" aria-label="Ğ¢ĞµĞ¼Ğ°" class="theme-select">
        <option value="main">Main</option>
        <option value="cat">Cat</option>
        <option value="hellowen">Hellowen</option>
        <option value="minecraft">Minecraft</option>
      </select>

      <!-- === Language Switcher in NAV (added) === -->
      <div class="nav-lang" id="langSwitcher" data-current="{{ current_lang or 'en' }}">
        <button class="lang-btn" id="langBtn" aria-haspopup="listbox" aria-expanded="false" title="Language">
          <span id="langFlag" class="flag-badge"></span><span class="lang-code" id="langCode"></span><span class="chev">â–¾</span>
        </button>
        <div class="lang-panel">
          <input id="langSearch" placeholder="Search language..." class="lang-search" />
          <ul class="lang-menu" id="langMenu" role="listbox" tabindex="-1"></ul>
        </div>
      </div>
      <!-- === /Language Switcher === -->

      {% set has_user =
           (g is defined and g.user) or
           (session and session.get('user_id')) or
           (current_user is defined and current_user.is_authenticated) %}

      {% if has_user %}
        <a class="nav-btn {{ 'active' if (request.endpoint and request.endpoint.endswith('top100')) else '' }}"
           href="{{ url_for('profile.top100') }}">Top-100</a>
        <span class="sep" aria-hidden="true">|</span>
        <a class="nav-btn {{ 'active' if (request.endpoint and request.endpoint.endswith('donate')) else '' }}"
           href="{{ url_for('profile.donate') }}">Donate</a>
        <span class="sep" aria-hidden="true">|</span>

        <a class="nav-btn {{ 'active' if (request.path == '/profile') else '' }}"
           href="/profile">ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ</a>

        {% if session.is_admin %}
          <span class="sep" aria-hidden="true">|</span>
          <a class="nav-btn {{ 'active' if (request.endpoint and request.endpoint=='admin_panel') else '' }}"
             href="{{ url_for('admin_panel') }}">Admin</a>
        {% endif %}

        <span class="user-chip" style="opacity:.8">
          {{ (g.user.name if g is defined and g.user and g.user.name
              else (current_user.name if current_user is defined and current_user.is_authenticated and current_user.name
              else (g.user.email if g is defined and g.user and g.user.email
              else (current_user.email if current_user is defined and current_user.is_authenticated else '')))) }}
          {% if g is defined and g.user and (g.user.pxp is not none) %} â€¢ PXP: {{ g.user.pxp }}{% endif %}
        </span>

        <a class="nav-btn" href="{{ url_for('auth.logout') }}">Ğ’Ğ¸Ğ¹Ñ‚Ğ¸</a>
      {% else %}
        <a class="nav-btn {{ 'active' if request.endpoint=='auth.login' else '' }}"
           href="{{ url_for('auth.login') }}">Ğ£Ğ²Ñ–Ğ¹Ñ‚Ğ¸</a>
      {% endif %}
    </div>
  </div>
</nav>

<!-- ĞŸĞ¾Ñ€Ñ‚Ğ°Ğ» Ğ´Ğ»Ñ Ğ´Ñ€Ğ¾Ğ¿Ğ´Ğ°ÑƒĞ½Ñ–Ğ² -->
<div id="nav-portal" style="position:fixed;left:0;top:0;width:0;height:0;z-index:2147483647;"></div>

<!-- ĞĞ’Ğ•Ğ Ğ›Ğ•Ğ™ Ğ† Ğ’Ğ˜Ğ‡Ğ—ĞĞ• ĞœĞ•ĞĞ® Ğ”Ğ›Ğ¯ ĞœĞĞ‘Ğ†Ğ›ĞšĞ˜ -->
<div class="drawer-overlay" id="drawerOverlay" hidden></div>
<aside class="drawer" id="mobileMenu" aria-hidden="true">
  <div class="drawer-head">
    <button class="drawer-close" id="drawerClose" aria-label="Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸">âœ•</button>
    <strong>ĞœĞµĞ½Ñ</strong>
  </div>

  <nav class="drawer-links">
    <a href="{{ url_for('index') }}"     class="{{ 'active' if request.endpoint=='index' else '' }}">Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°</a>
    <a href="{{ url_for('stl') }}"       class="{{ 'active' if request.endpoint=='stl' else '' }}">STL3D</a>
    <a href="{{ url_for('video') }}"     class="{{ 'active' if request.endpoint=='video' else '' }}">Video</a>
    <a href="{{ url_for('photo') }}"      class="{{ 'active' if request.endpoint=='photo' else '' }}">Photo â€” Gallery / Tools</a>
    <a href="{{ url_for('enhance') }}"    class="{{ 'active' if request.endpoint=='enhance' else '' }}">Photo Enhance</a>
    <a href="{{ url_for('edit_photo') }}" class="{{ 'active' if request.endpoint=='edit_photo' else '' }}">Edit Photo</a>

    <!-- NEW: Documents (mobile) -->
    <a href="{{ url_for('documents') }}" class="{{ 'active' if request.endpoint=='documents' else '' }}">Documents</a>

    <a href="{{ url_for('market.page_market') }}" class="{{ 'active' if (request.endpoint and request.endpoint=='market.page_market') else '' }}">Market</a>

    <hr>

    <div class="drawer-theme">
      <label for="themeSelectDrawer">Ğ¢ĞµĞ¼Ğ°</label>
      <select id="themeSelectDrawer">
        <option value="main">Main</option>
        <option value="cat">Cat</option>
        <option value="hellowen">Hellowen</option>
        <option value="minecraft">Minecraft</option>
      </select>
    </div>

    <hr>

    {% if has_user %}
      <a href="{{ url_for('profile.top100') }}"  class="{{ 'active' if (request.endpoint and request.endpoint.endswith('top100')) else '' }}">Top-100</a>
      <a href="{{ url_for('profile.donate') }}"  class="{{ 'active' if (request.endpoint and request.endpoint.endswith('donate')) else '' }}">Donate</a>
      <a href="/profile"                         class="{{ 'active' if (request.path == '/profile') else '' }}">ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ</a>
      {% if session.is_admin %}
        <a href="{{ url_for('admin_panel') }}"   class="{{ 'active' if (request.endpoint and request.endpoint=='admin_panel') else '' }}">Admin</a>
      {% endif %}
      <a href="{{ url_for('auth.logout') }}">Ğ’Ğ¸Ğ¹Ñ‚Ğ¸</a>
    {% else %}
      <a href="{{ url_for('auth.login') }}" class="{{ 'active' if request.endpoint=='auth.login' else '' }}">Ğ£Ğ²Ñ–Ğ¹Ñ‚Ğ¸</a>
    {% endif %}
  </nav>
</aside>

<script>
  (function(){
    var THEME_MAP = {
      main:      "{{ url_for('static', filename='themes/main.css') }}",
      cat:       "{{ url_for('static', filename='themes/cat.css') }}",
      hellowen:  "{{ url_for('static', filename='themes/hellowen.css') }}",
      minecraft: "{{ url_for('static', filename='themes/minecraft.css') }}"
    };

    function applyTheme(v){
      var base = THEME_MAP[v] || THEME_MAP.main;
      var head = document.getElementsByTagName('head')[0];
      var old  = document.getElementById('theme-css');

      var link = document.createElement('link');
      link.rel  = 'stylesheet';
      link.id   = 'theme-css';
      link.href = base + '?v=' + Date.now();

      if (old && old.parentNode) old.parentNode.removeChild(old);
      head.appendChild(link);

      localStorage.setItem('theme', v);
      document.documentElement.setAttribute('data-theme', v);
    }

    var select = document.getElementById('themeSelect');
    var saved  = localStorage.getItem('theme') || 'main';
    if (select) select.value = (saved in THEME_MAP) ? saved : 'main';
    applyTheme(saved);
    if (select) select.addEventListener('change', function(){ applyTheme(this.value); });

    var selectDrawer = document.getElementById('themeSelectDrawer');
    if (selectDrawer){
      selectDrawer.value = localStorage.getItem('theme') || 'main';
      selectDrawer.addEventListener('change', function(){
        applyTheme(this.value);
        if (select) select.value = this.value;
      });
    }

    var burger = document.getElementById('burger');
    var drawer = document.getElementById('mobileMenu');
    var overlay= document.getElementById('drawerOverlay');
    var close  = document.getElementById('drawerClose');

    function openDrawer(){
      drawer.classList.add('open');
      overlay.hidden = false;
      document.body.style.overflow = 'hidden';
      burger.setAttribute('aria-expanded','true');
      drawer.setAttribute('aria-hidden','false');
    }
    function closeDrawer(){
      drawer.classList.remove('open');
      overlay.hidden = true;
      document.body.style.overflow = '';
      burger.setAttribute('aria-expanded','false');
      drawer.setAttribute('aria-hidden','true');
    }

    burger && burger.addEventListener('click', openDrawer);
    overlay && overlay.addEventListener('click', closeDrawer);
    close && close.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape' && drawer.classList.contains('open')) closeDrawer();
    });
  })();

  /* Ğ”Ñ€Ğ¾Ğ¿Ğ´Ğ°ÑƒĞ½ Photo â€” Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» Ñƒ body + ĞºĞ»Ñ–ĞºĞ¸ Ğ¿Ğ¾ Ğ»Ñ–Ğ½ĞºĞ°Ñ… */
  (function(){
    var root   = document.querySelector('[data-dd]');
    if(!root) return;

    var btn    = root.querySelector('.dd-trigger');
    var menu   = root.querySelector('.dd-menu');
    var portal = document.getElementById('nav-portal');
    var inPortal = false;

    function placeMenu(){
      if(!btn || !menu || !portal) return;
      var r = btn.getBoundingClientRect();
      menu.style.position = 'fixed';
      menu.style.left = r.left + 'px';
      menu.style.top  = (r.bottom + 6) + 'px';
      menu.style.display = 'block';
      menu.style.zIndex  = '2147483647';
      portal.appendChild(menu);
      inPortal = true;
      btn.setAttribute('aria-expanded','true');
    }

    function restoreMenu(){
      if(inPortal && root && menu){
        menu.removeAttribute('style');
        root.appendChild(menu);
      }
      inPortal = false;
      btn && btn.setAttribute('aria-expanded','false');
      root.classList.remove('open');
    }

    function toggle(){
      if(inPortal){ restoreMenu(); }
      else { root.classList.add('open'); placeMenu(); }
    }

    btn && btn.addEventListener('click', function(e){
      e.stopPropagation();
      toggle();
    });

    document.addEventListener('click', function(e){
      if(!inPortal) return;
      if(menu && !menu.contains(e.target) && btn && !btn.contains(e.target)){
        restoreMenu();
      }
    });

    ['scroll','resize'].forEach(ev=>{
      window.addEventListener(ev, function(){
        if(!inPortal) return;
        placeMenu();
      }, { passive:true });
    });

    menu.querySelectorAll('a.dd-item').forEach(function(a){
      a.addEventListener('click', function(){
        setTimeout(restoreMenu, 0);
      });
    });
  })();

  /* === Language Switcher JS (Ñ‚Ğ²Ñ–Ğ¹ ĞºĞ¾Ğ´, Ğ‘Ğ•Ğ— Ğ·Ğ¼Ñ–Ğ½Ğ¸ Ğ»Ğ¾Ğ³Ñ–ĞºĞ¸) === */
  (function(){
    var root = document.getElementById('langSwitcher');
    if(!root) return;
    var btn    = document.getElementById('langBtn');
    var menu   = document.getElementById('langMenu');
    var search = document.getElementById('langSearch');
    var flagEl = document.getElementById('langFlag');
    var codeEl = document.getElementById('langCode');

    var LANGS = {
      af:"ğŸ‡¿ğŸ‡¦ Afrikaans", sq:"ğŸ‡¦ğŸ‡± Albanian", am:"ğŸ‡ªğŸ‡¹ Amharic", ar:"ğŸ‡¸ğŸ‡¦ Arabic", hy:"ğŸ‡¦ğŸ‡² Armenian",
      az:"ğŸ‡¦ğŸ‡¿ Azerbaijani", eu:"ğŸ‡ªğŸ‡¸ Basque", be:"ğŸ‡§ğŸ‡¾ Belarusian", bn:"ğŸ‡§ğŸ‡© Bengali", bs:"ğŸ‡§ğŸ‡¦ Bosnian",
      bg:"ğŸ‡§ğŸ‡¬ Bulgarian", my:"ğŸ‡²ğŸ‡² Burmese", ca:"ğŸ‡ªğŸ‡¸ Catalan", zh:"ğŸ‡¨ğŸ‡³ Chinese", hr:"ğŸ‡­ğŸ‡· Croatian",
      cs:"ğŸ‡¨ğŸ‡¿ Czech", da:"ğŸ‡©ğŸ‡° Danish", nl:"ğŸ‡³ğŸ‡± Dutch", en:"ğŸ‡¬ğŸ‡§ English", et:"ğŸ‡ªğŸ‡ª Estonian",
      fi:"ğŸ‡«ğŸ‡® Finnish", fr:"ğŸ‡«ğŸ‡· French", ka:"ğŸ‡¬ğŸ‡ª Georgian", de:"ğŸ‡©ğŸ‡ª German", el:"ğŸ‡¬ğŸ‡· Greek",
      he:"ğŸ‡®ğŸ‡± Hebrew", hi:"ğŸ‡®ğŸ‡³ Hindi", hu:"ğŸ‡­ğŸ‡º Hungarian", is:"ğŸ‡®ğŸ‡¸ Icelandic", id:"ğŸ‡®ğŸ‡© Indonesian",
      ga:"ğŸ‡®ğŸ‡ª Irish", it:"ğŸ‡®ğŸ‡¹ Italian", ja:"ğŸ‡¯ğŸ‡µ Japanese", jv:"ğŸ‡®ğŸ‡© Javanese", kn:"ğŸ‡®ğŸ‡³ Kannada",
      kk:"ğŸ‡°ğŸ‡¿ Kazakh", km:"ğŸ‡°ğŸ‡­ Khmer", ko:"ğŸ‡°ğŸ‡· Korean", ky:"ğŸ‡°ğŸ‡¬ Kyrgyz", lo:"ğŸ‡±ğŸ‡¦ Lao",
      lv:"ğŸ‡±ğŸ‡» Latvian", lt:"ğŸ‡±ğŸ‡¹ Lithuanian", mk:"ğŸ‡²ğŸ‡° Macedonian", ms:"ğŸ‡²ğŸ‡¾ Malay", ml:"ğŸ‡®ğŸ‡³ Malayalam",
      mt:"ğŸ‡²ğŸ‡¹ Maltese", mi:"ğŸ‡³ğŸ‡¿ Maori", mr:"ğŸ‡®ğŸ‡³ Marathi", mn:"ğŸ‡²ğŸ‡³ Mongolian", ne:"ğŸ‡³ğŸ‡µ Nepali",
      no:"ğŸ‡³ğŸ‡´ Norwegian", fa:"ğŸ‡®ğŸ‡· Persian", pl:"ğŸ‡µğŸ‡± Polish", pt:"ğŸ‡µğŸ‡¹ Portuguese", pa:"ğŸ‡®ğŸ‡³ Punjabi",
      ro:"ğŸ‡·ğŸ‡´ Romanian", ru:"ğŸ‡·ğŸ‡º Russian", sr:"ğŸ‡·ğŸ‡¸ Serbian", si:"ğŸ‡±ğŸ‡° Sinhala", sk:"ğŸ‡¸ğŸ‡° Slovak",
      sl:"ğŸ‡¸ğŸ‡® Slovenian", so:"ğŸ‡¸ğŸ‡´ Somali", es:"ğŸ‡ªğŸ‡¸ Spanish", su:"ğŸ‡®ğŸ‡© Sundanese", sw:"ğŸ‡°ğŸ‡ª Swahili",
      sv:"ğŸ‡¸ğŸ‡ª Swedish", tl:"ğŸ‡µğŸ‡­ Tagalog", tg:"ğŸ‡¹ğŸ‡¯ Tajik", ta:"ğŸ‡®ğŸ‡³ Tamil", te:"ğŸ‡®ğŸ‡³ Telugu",
      th:"ğŸ‡¹ğŸ‡­ Thai", tr:"ğŸ‡¹ğŸ‡· Turkish", uk:"ğŸ‡ºğŸ‡¦ Ukrainian", ur:"ğŸ‡µğŸ‡° Urdu", uz:"ğŸ‡ºğŸ‡¿ Uzbek",
      vi:"ğŸ‡»ğŸ‡³ Vietnamese", cy:"ğŸ´ Welsh", xh:"ğŸ‡¿ğŸ‡¦ Xhosa", yi:"ğŸ‡®ğŸ‡± Yiddish", zu:"ğŸ‡¿ğŸ‡¦ Zulu"
    };

    var current = ((root.dataset.current||'en') || localStorage.getItem('lng') || 'en').toLowerCase();
    if(!LANGS[current]) current = 'en';

    function renderBtn(){
      var label = LANGS[current] || 'ğŸŒ Language';
      var flag  = label.split(' ')[0] || 'ğŸŒ';
      flagEl.textContent = flag;
      codeEl.textContent = ' ' + current.toUpperCase();
    }

    function openMenu(){ root.classList.add('open'); menu.classList.add('open'); }
    function closeMenu(){ root.classList.remove('open'); menu.classList.remove('open'); }
    function toggleMenu(){ menu.classList.toggle('open'); root.classList.toggle('open'); }

    function buildList(){
      menu.innerHTML = '';
      Object.keys(LANGS).forEach(function(code){
        var label = LANGS[code];               // "ğŸ‡¬ğŸ‡§ English"
        var flag  = (label.split(' ')[0]||'ğŸŒ');
        var name  = label.substring(flag.length).trim();

        var li = document.createElement('li');
        li.setAttribute('data-lang', code);
        li.innerHTML =
          '<span class="flag" aria-hidden="true">'+flag+'</span>' +
          '<span class="name">'+name+'</span>' +
          '<span class="short">('+code.toUpperCase()+')</span>';
        menu.appendChild(li);
      });
    }

    function bindSearch(){
      if(!search) return;
      search.addEventListener('input', function(e){
        var q = e.target.value.toLowerCase();
        Array.prototype.forEach.call(menu.children, function(li){
          var txt = li.textContent.toLowerCase();
          li.style.display = (txt.indexOf(q) !== -1) ? '' : 'none';
        });
      });
    }

    function onPick(code){
      current = code;
      localStorage.setItem('lng', code);
      renderBtn();
      closeMenu();
      fetch('/api/lang/set', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ lang: code })
      }).catch(function(){});
      if(window.i18next){
        i18next.changeLanguage(code).then(function(){
          document.querySelectorAll('[data-i18n]').forEach(function(el){
            el.textContent = i18next.t(el.getAttribute('data-i18n'));
          });
        });
      }
      /* Ñ‚Ñ€Ğ¸Ğ³ĞµÑ€ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞºĞ»Ğ°Ğ´Ñƒ DOM */
      if (window.__i18nSetLang) { window.__i18nSetLang(code); }
    }

    btn && btn.addEventListener('click', function(e){ e.stopPropagation(); toggleMenu(); });
    document.addEventListener('click', function(e){
      if(!root.contains(e.target)) closeMenu();
    });
    menu.addEventListener('click', function(e){
      var li = e.target.closest('li[data-lang]');
      if(!li) return;
      onPick(li.getAttribute('data-lang'));
    });

    buildList(); bindSearch(); renderBtn();

    fetch('/api/lang/me').then(function(r){ return r.json(); }).then(function(js){
      if(js && js.lang && LANGS[js.lang]){
        current = js.lang;
        localStorage.setItem('lng', current);
        renderBtn();
        if(window.i18next){
          i18next.changeLanguage(current).then(function(){
            document.querySelectorAll('[data-i18n]').forEach(function(el){
              el.textContent = i18next.t(el.getAttribute('data-i18n'));
            });
          });
        }
        if (window.__i18nSetLang) { window.__i18nSetLang(current); }
      }
    }).catch(function(){});
  })();

  /* === Language panel â†’ portal (observer) â€” ĞĞ• Ğ·Ğ¼Ñ–Ğ½ÑÑ” Ñ‚Ğ²Ğ¾Ñ— Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ— === */
  (function(){
    var root = document.getElementById('langSwitcher');
    if(!root) return;
    var panel  = root.querySelector('.lang-panel');
    var btn    = document.getElementById('langBtn');
    var portal = document.getElementById('nav-portal');
    var inPortal = false;

    function place(){
      if(!panel || !btn || !portal) return;
      var r = btn.getBoundingClientRect();
      panel.style.position = 'fixed';
      panel.style.left = r.left + 'px';
      panel.style.top  = (r.bottom + 6) + 'px';
      panel.style.display = 'block';
      panel.style.zIndex  = '2147483647';
      portal.appendChild(panel);
      inPortal = true;
    }
    function restore(){
      if(inPortal){
        panel.removeAttribute('style');
        root.appendChild(panel);
        inPortal = false;
      }
    }

    // ÑĞ¿Ğ¾ÑÑ‚ĞµÑ€Ñ–Ğ³Ğ°Ñ‡ Ğ·Ğ° ĞºĞ»Ğ°ÑĞ¾Ğ¼ .open Ğ½Ğ° .nav-lang
    var mo = new MutationObserver(function(muts){
      muts.forEach(function(m){
        if(m.attributeName === 'class'){
          if(root.classList.contains('open')) place();
          else restore();
        }
      });
    });
    mo.observe(root, { attributes:true });

    ['scroll','resize'].forEach(function(ev){
      window.addEventListener(ev, function(){ if(inPortal) place(); }, {passive:true});
    });

    document.addEventListener('click', function(e){
      if(inPortal && !panel.contains(e.target) && !btn.contains(e.target)) restore();
    });
  })();
</script>

{% if request.endpoint not in ["auth.login", "auth.register", "auth.logout"] %}
  {% include "chat.html" %}
{% endif %}

<style>
/* ====== ĞĞĞ’Ğ†Ğ“ĞĞ¦Ğ†Ğ¯ ====== */
.navbar{
  position:sticky;
  top:0;
  z-index:2147483647;
  background:#0b0d12;
  border-bottom:1px solid #1b2131;
  overflow:visible;
  isolation:isolate;
}
.nav-wrap{
  max-width:1368px;
  margin:0 auto;
  display:flex;
  align-items:center;
  flex-wrap:nowrap;
  white-space:nowrap;
  gap:6px;
  padding:6px 10px 6px 4px;
  min-height:72px;
  overflow-x:auto;
  overflow-y:visible;
}

/* Ğ±ÑƒÑ€Ğ³ĞµÑ€ (Ğ´ĞµÑĞºÑ‚Ğ¾Ğ¿ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ²Ğ°Ğ½Ğ¾) */
.burger{
  display:none;
  font-size:20px;line-height:1;
  border:1px solid #1b2131;background:transparent;color:#e8eaed;
  border-radius:10px;width:38px;height:38px;cursor:pointer
}

/* Ğ›ĞĞ“Ğ + ĞĞĞ—Ğ’Ğ */
.brand{display:flex;align-items:center;gap:8px;padding:0 2px;border-radius:10px;border:1px solid transparent;text-decoration:none}
.brand img{height:44px;width:auto;display:block;object-fit:contain;filter:drop-shadow(0 4px 10px rgba(173,92,255,.25))}
.wordmark{
  font-weight:900;letter-spacing:.25px;line-height:1;font-size:22px;text-transform:capitalize;
  background:linear-gradient(90deg,#ff3cac 0%, #784ba0 45%, #2b86c5 100%);
  -webkit-background-clip:text;background-clip:text;color:transparent;
  text-shadow:0 0 12px rgba(123,162,255,.22);
  transition:transform .15s ease, letter-spacing .15s ease, filter .15s ease;
}
.brand:hover .wordmark{transform:translateY(-1px);letter-spacing:.4px;filter:brightness(1.08)}

/* ĞšĞĞĞŸĞšĞ˜ */
.nav-btn{ padding:7px 11px !important; font-size:14.5px !important; margin:0 !important; white-space:nowrap; }

/* ÑĞµĞ»ĞµĞºÑ‚ Ñ‚ĞµĞ¼Ğ¸ */
.theme-select{ height:30px; border-radius:8px; padding:0 8px; font-size:14px; background:transparent; color:#e8eaed; border:1px solid #1b2131; }

/* Ñ€Ğ¾Ğ·Ğ´Ñ–Ğ»ÑŒĞ½Ğ¸ĞºĞ¸ */
.sep{opacity:.7}

/* Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº */
.nav-right{gap:8px !important}

/* Dropdown â€” Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ– ÑÑ‚Ğ¸Ğ»Ñ–; Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğµ Ğ¼ĞµĞ½Ñ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ÑŒÑÑ Ñƒ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» */
.nav-dropdown{ position:relative; display:inline-block; }
.dd-trigger{ display:inline-flex; align-items:center; gap:6px; }
.dd-caret{
  display:inline-block; width:0; height:0;
  border-left:5px solid transparent; border-right:5px solid transparent;
  border-top:6px solid var(--text, #e8eaed);
  transition:transform .15s ease;
}
.nav-dropdown.open .dd-caret{ transform:rotate(180deg); }

.dd-menu{
  background:var(--card, #101522);
  border:1px solid #1b2131;
  border-radius:10px;
  padding:6px;
  box-shadow:0 8px 24px rgba(0,0,0,.35);
  display:none;
  pointer-events:auto;
}
.dd-menu, .dd-menu *{ pointer-events:auto; }
.dd-item{ display:block; padding:10px 12px; border-radius:8px; color:var(--text, #e8eaed); text-decoration:none; white-space:nowrap; }
.dd-item:hover{ background:var(--chip, #182034); }

/* === Language Switcher === */
.nav-lang{ position:relative; }
.nav-lang .lang-btn{
  display:flex; align-items:center; gap:8px;
  background:#151a24; color:#e6e9ef; border:1px solid #262e42;
  padding:6px 10px; border-radius:10px; cursor:pointer;
  font-size:14px; transition:.15s;
}
.nav-lang .lang-btn:hover{ background:#1d2330; border-color:#3a4560; }
.nav-lang .chev{ opacity:.8; margin-left:4px; }

/* Ğ“ĞĞ›ĞĞ’ĞĞ•: Ğ¿Ğ¾ĞºĞ°Ğ· Ğ¿Ğ°Ğ½ĞµĞ»Ñ– Ğ¿Ñ€Ğ¸ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ñ‚Ñ– */
.nav-lang.open .lang-panel{ display:block; }

.nav-lang .lang-panel{
  position:absolute; top:100%; right:0; margin-top:6px;
  background:#101522; border:1px solid #262e42; border-radius:12px;
  min-width:280px; max-height:360px; overflow:hidden; display:none;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

/* Ğ¿Ğ¾ÑˆÑƒĞº Ñ– ÑĞ¿Ğ¸ÑĞ¾Ğº */
.lang-search{
  width:calc(100% - 16px); padding:8px 10px; border:1px solid #2a3248; outline:none;
  background:#141a28; color:#e6e9ef; border-radius:10px; margin:8px;
  font-size:14px;
}
.lang-menu{ margin:0; padding:6px 8px 10px; list-style:none; max-height:280px; overflow:auto;
  display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); grid-auto-rows:minmax(36px,auto); gap:6px 8px; }
.lang-menu li{
  padding:8px 10px; border-radius:10px; cursor:pointer;
  color:#dbe1f1; font-size:14px; display:flex; align-items:center; gap:10px;
  border:1px solid transparent;
}
.lang-menu li:hover{ background:#161b28; border-color:#28324a; }
.lang-menu .flag{ font-size:18px; line-height:1; }
.lang-menu .name{ flex:1 1 auto; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.lang-menu .short{ opacity:.7; font-size:12px; }

/* Ğ·Ğ½Ğ°Ñ‡Ğ¾Ğº Ñƒ ĞºĞ½Ğ¾Ğ¿Ñ†Ñ– */
.flag-badge{ font-size:18px; line-height:1; }

/* ====== ĞœĞĞ‘Ğ†Ğ›Ğ¬ĞĞ˜Ğ™ DRAWER (Ğ´Ğ¾Ğ´Ğ°Ğ½Ğ¾) ====== */
.drawer-overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.55);
  z-index:2147483646;           /* Ğ¿Ñ–Ğ´ ÑˆÑƒÑ…Ğ»ÑĞ´Ğ¾Ñ, Ğ°Ğ»Ğµ Ğ½Ğ°Ğ´ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ¾Ğ¼ */
}
.drawer{
  position:fixed; top:0; right:0;
  height:100vh; width:320px; max-width:85vw;
  background:#0e0f12;
  border-left:1px solid #1b2131;
  box-shadow:-12px 0 30px rgba(0,0,0,.5);
  transform:translateX(110%);
  transition:transform .28s cubic-bezier(.2,.9,.2,1);
  z-index:2147483647;           /* Ğ½Ğ°Ğ´ navbar */
  display:flex; flex-direction:column;
}
.drawer.open{ transform:translateX(0); }
.drawer-head{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px; padding:14px 16px;
  border-bottom:1px solid #1b2131;
}
.drawer-close{ background:none; border:0; color:#e8eaed; font-size:20px; cursor:pointer; }
.drawer-links{ display:flex; flex-direction:column; gap:4px; padding:10px 12px 18px; overflow:auto; }
.drawer-links a{
  padding:10px 12px; border-radius:10px; text-decoration:none; color:#e8eaed;
}
.drawer-links a:hover{ background:#182034; }
.drawer-theme{ display:flex; align-items:center; gap:10px; padding:0 12px; }

/* ĞÑ–Ñ‡Ğ¾Ğ³Ğ¾ Ğ½Ğµ Ğ¾Ğ±Ñ€Ñ–Ğ·Ğ°Ñ”Ğ¼Ğ¾ */
.navbar{ overflow:visible; }
.nav-wrap{ overflow-y:visible; overflow-x:auto; }

/* ĞŸÑ€Ğ¸ Ğ¼Ğ°Ğ»Ñ–Ğ¹ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñ– â€” Ğ¼Ğ¾Ğ±. Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚ */
@media (max-width: 1360px){
  .user-chip{display:none}
  .sep{display:none}
}
@media (max-width: 1280px){
  .nav-btn{padding:6px 10px !important;font-size:14px !important}
  .brand img{height:42px}
  .wordmark{font-size:21px}
}
@media (max-width: 768px){
  .nav-wrap > .nav-btn, .nav-right, .nav-dropdown{ display:none !important; }
  .burger{ display:inline-flex; align-items:center; justify-content:center; }
  .brand img{height:38px}
  .wordmark{font-size:20px}
  .nav-wrap{ min-height:64px; padding-left:8px; }
}
@media (min-width: 769px){
  .drawer, .drawer-overlay{ display:none !important; }
}
</style>
