<nav class="navbar">
  <ul class="nav">
    <!-- Ліва частина (публічні) -->
    <li><a class="{{ 'active' if request.endpoint=='index' else '' }}" href="{{ url_for('index') }}">Головна</a></li>
    <li><a class="{{ 'active' if request.endpoint=='stl' else '' }}" href="{{ url_for('stl') }}">STL3D</a></li>
    <li><a class="{{ 'active' if request.endpoint=='video' else '' }}" href="{{ url_for('video') }}">Video</a></li>
    <li><a class="{{ 'active' if request.endpoint=='enhance' else '' }}" href="{{ url_for('enhance') }}">Photo Enhance</a></li>
    <li><a class="{{ 'active' if request.endpoint=='edit_photo' else '' }}" href="{{ url_for('edit_photo') }}">Edit Photo</a></li>
    <li><a class="{{ 'active' if request.endpoint=='photo' else '' }}" href="{{ url_for('photo') }}">Photo</a></li>

    <!-- Права частина -->
    <li class="ml-auto">
      <!-- Перемикач теми -->
      <div class="theme-switch">
        <span>Тема:</span>
        <select id="themeSelect" title="Вибрати тему">
          <option value="dark">Dark</option>
          <option value="light">Light</option>
          <option value="midnight">Midnight</option>
        </select>
      </div>

      {% set is_auth = (current_user is defined and current_user) %}
      {% if is_auth %}
        <!-- Приватні -->
        <a class="{{ 'active' if request.endpoint=='profile.top100' else '' }}" href="{{ url_for('profile.top100') }}">Top-100</a>
        &nbsp;|&nbsp;
        <a class="{{ 'active' if request.endpoint=='profile.donate' else '' }}" href="{{ url_for('profile.donate') }}">Donate</a>
        &nbsp;|&nbsp;
        <a class="{{ 'active' if request.endpoint=='profile.profile' else '' }}" href="{{ url_for('profile.profile') }}">Профіль</a>
        &nbsp;|&nbsp;
        {{ (current_user.name or current_user.email)|default('', true) }}
        &nbsp;|&nbsp; PXP: {{ pxp|default(0, true) }}
        &nbsp;|&nbsp;
        <form method="post" action="{{ url_for('auth.logout') }}" style="display:inline;margin:0">
          <button type="submit" class="as-link">Вийти</button>
        </form>
      {% else %}
        PXP: {{ pxp|default(0, true) }}
        &nbsp;<a class="{{ 'active' if request.endpoint=='auth.login' else '' }}"
                 href="{{ url_for('auth.login', next=request.full_path if request.query_string else request.path) }}">Увійти</a>
        &nbsp;<a class="{{ 'active' if request.endpoint=='auth.register' else '' }}"
                 href="{{ url_for('auth.register', next=request.full_path if request.query_string else request.path) }}">Реєстрація</a>
      {% endif %}
    </li>
  </ul>
</nav>

<style>
  .navbar{background:var(--nav-bg,#0b0d12);border-bottom:1px solid var(--line,#1b2131)}
  .nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:16px;
       height:56px;padding:0 20px;list-style:none}
  .nav a{color:var(--ink,#e8eaed);text-decoration:none;padding:4px 6px;border-bottom:2px solid transparent}
  .nav a.active{border-bottom-color:#6ea8fe}
  .ml-auto{margin-left:auto;display:flex;align-items:center;gap:10px}
  .as-link{background:none;border:0;color:#8ab4ff;cursor:pointer;padding:0;font:inherit}
  .as-link:hover{text-decoration:underline}

  .theme-switch{display:flex;align-items:center;gap:6px;margin-right:8px}
  .theme-switch span{color:var(--muted,#9fb0d4);font-size:.9rem}
  .theme-switch select{
    background:var(--card,#11141b); color:var(--ink,#e8eaed);
    border:1px solid var(--line,#1b2131); border-radius:8px;
    padding:4px 8px; outline:none; cursor:pointer
  }
</style>

<script>
  (function(){
    // карти тем -> css
    const cssMap = {
      dark: '{{ url_for("static", filename="themes/dark.css") }}',
      light: '{{ url_for("static", filename="themes/light.css") }}',
      midnight: '{{ url_for("static", filename="themes/midnight.css") }}'
    };

    const select = document.getElementById('themeSelect');
    if (!select) return;

    // поточна тема з localStorage
    const current = localStorage.getItem('theme') || 'dark';
    select.value = cssMap[current] ? current : 'dark';

    function applyTheme(key){
      const href = cssMap[key] || cssMap.dark;
      const link = document.getElementById('theme-css');
      if (link) link.href = href;
      document.documentElement.setAttribute('data-theme', key);
      localStorage.setItem('theme', key);
    }

    // одразу застосуємо (на випадок, якщо base вже поставив — це просто синхронізація селекта)
    applyTheme(select.value);

    select.addEventListener('change', function(){
      applyTheme(this.value);
    });
  })();
</script>
