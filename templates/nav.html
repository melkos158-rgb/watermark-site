<nav class="navbar">
  <div class="nav-wrap">
    <!-- Ліва частина -->
    <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('index') else '' }}" href="{{ url_for('index') }}">Головна</a>
    <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('stl') else '' }}" href="{{ url_for('stl') }}">STL3D</a>
    <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('video') else '' }}" href="{{ url_for('video') }}">Video</a>
    <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('enhance') else '' }}" href="{{ url_for('enhance') }}">Photo Enhance</a>
    <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('edit_photo') else '' }}" href="{{ url_for('edit_photo') }}">Edit Photo</a>
    <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('photo') else '' }}" href="{{ url_for('photo') }}">Photo</a>

    <!-- Права частина -->
    <div style="display:flex; align-items:center; gap:12px; margin-left:auto">
      <!-- Перемикач тем -->
      <label for="themeSelect" class="sr-only">Тема</label>
      <select id="themeSelect" aria-label="Вибір теми" style="height:32px; border-radius:8px; padding:0 8px;">
        <option value="main">Main</option>
        <option value="cat">Cat</option>
        <option value="hellowen">Hellowen</option>
        <option value="minecraft">Minecraft</option>
      </select>

      <!-- Додаткові сторінки (у Blueprint 'profile') -->
      <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('top100') else '' }}" href="{{ url_for('profile.top100') }}">Top-100</a>
      <span aria-hidden="true">|</span>
      <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('donate') else '' }}" href="{{ url_for('profile.donate') }}">Donate</a>
      <span aria-hidden="true">|</span>

      {% if g.user and g.user.is_authenticated %}
        <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('profile') else '' }}" href="{{ url_for('profile.profile') }}">Профіль</a>
        <span style="opacity:.8">{{ g.user.name or '' }}</span>
        <a class="nav-btn" href="{{ url_for('auth.logout') }}">Вийти</a>
      {% else %}
        <a class="nav-btn {{ 'active' if request.endpoint and request.endpoint.endswith('login') else '' }}" href="{{ url_for('auth.login') }}">Увійти</a>
      {% endif %}
    </div>
  </div>
</nav>

<script>
  (function(){
    var THEME_MAP = {
      main:      "{{ url_for('static', filename='themes/main.css') }}",
      cat:       "{{ url_for('static', filename='themes/cat.css') }}",
      hellowen:  "{{ url_for('static', filename='themes/hellowen.css') }}",
      minecraft: "{{ url_for('static', filename='themes/minecraft.css') }}"
    };

    var select = document.getElementById('themeSelect');
    var linkEl = document.getElementById('theme-css');

    // початкове значення
    var saved = localStorage.getItem('theme') || 'main';
    if (select) select.value = THEME_MAP[saved] ? saved : 'main';

    function applyTheme(val){
      var href = THEME_MAP[val] || THEME_MAP.main;
      if (linkEl) linkEl.href = href;
      localStorage.setItem('theme', val);
      document.documentElement.setAttribute('data-theme', val);
    }

    if (select) {
      select.addEventListener('change', function(){
        applyTheme(this.value);
      });
    }

    // Синхронізація селекта, якщо тема підвантажена інакша
    if (linkEl) {
      var currentHref = linkEl.getAttribute('href') || '';
      var currentKey = Object.keys(THEME_MAP).find(k => currentHref.includes('/' + k + '.css'));
      if (currentKey && currentKey !== select.value) {
        select.value = currentKey;
        localStorage.setItem('theme', currentKey);
        document.documentElement.setAttribute('data-theme', currentKey);
      }
    }
  })();
</script>
