{% extends "base.html" %}
{% set page = 'documents' %}
{% block title %}PDF Test{% endblock %}

{% block content %}
<input id="fileInput" type="file" accept="application/pdf">
<canvas id="pdfCanvas" style="width:100%;max-width:900px;margin-top:10px;border:1px solid #555;"></canvas>

<script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js";

document.getElementById('fileInput').addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return alert("Обери PDF!");
  const buf = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data: buf}).promise;
  const page = await pdf.getPage(1);
  const viewport = page.getViewport({scale: 1.5});
  const canvas = document.getElementById('pdfCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = viewport.width;
  canvas.height = viewport.height;
  await page.render({canvasContext: ctx, viewport: viewport}).promise;
});
</script>
{% endblock %}
