{% extends "base.html" %}
{% block title %}Dev Issues{% endblock %}

{% block content %}

<h1 style="margin-bottom: 20px;">üõ† Dev Issues ‚Äî –ø—Ä–æ–±–ª–µ–º–∏, –ø—Ä–∞–≤–∫–∏ —Ç–∞ —Å—ñ—Ä–∏–π –∫–æ–¥</h1>

<link rel="stylesheet" href="{{ url_for('static', filename='css/dev_issues.css') }}">
<script src="{{ url_for('static', filename='js/dev_issues.js') }}"></script>

<div class="dev-issues-container">

  {% if items %}
    {% for it in items %}
      <div class="issue-card issue-{{ it.status }}" data-id="{{ it.id }}">
        
        <div class="issue-top">
          <div class="issue-title">
            {{ it.title }}
          </div>

          <div class="issue-status">
            {% if it.status == "error" %}
              üî¥ –ü—Ä–æ–±–ª–µ–º–∞
            {% elif it.status == "fix" %}
              üîµ –ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø—Ä–∞–≤–∫–∞
            {% elif it.status == "orphan" %}
              ‚ö™ –ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ
            {% else %}
              üü¢ –û–ö
            {% endif %}
          </div>
        </div>

        <div class="issue-section">
          <strong>URL / Root:</strong> {{ it.root.label }}
        </div>

        <div class="issue-section">
          <strong>–§–∞–π–ª–∏:</strong>
          <ul>
            {% for n in it.nodes %}
              <li>{{ n.file }}</li>
            {% endfor %}
          </ul>
        </div>

        {% if it.problems %}
        <div class="issue-section">
          <strong>–ü—Ä–æ–±–ª–µ–º–∏:</strong>
          <ul>
            {% for p in it.problems %}
              <li class="problem-item"
                  data-feature="{{ it.title }}"
                  data-file="{{ p.file }}"
                  data-function="{{ p.function or '' }}"
                  data-details="{{ p.details|e }}"
                  data-status="{{ p.status }}">
                <span class="problem-link">
                  {% if p.status == "error" %}üî¥{% endif %}
                  {% if p.status == "fix" %}üîµ{% endif %}
                  {% if p.status == "orphan" %}‚ö™{% endif %}
                  {{ p.title }}
                </span>
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

      </div>
    {% endfor %}

  {% else %}
    <p>–ù–µ–º–∞—î –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.</p>
  {% endif %}

</div>


<!-- === –î–µ—Ç–∞–ª—ñ –ø—Ä–æ–±–ª–µ–º—É ‚Äî –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –ø—Ä–∏ –∫–ª—ñ–∫—É === -->

<div id="problem-detail" class="problem-detail" style="display:none;">
  <h2 id="pd-title">–î–µ—Ç–∞–ª—ñ –ø—Ä–æ–±–ª–µ–º–∏</h2>
  <pre id="pd-text"></pre>
</div>

<script>
document.querySelectorAll('.problem-item').forEach(el => {
  el.addEventListener('click', () => {

    const feature = el.dataset.feature;
    const file = el.dataset.file;
    const func = el.dataset.function;
    const details = el.dataset.details;

    document.getElementById("pd-title").textContent = "–ü—Ä–æ–±–ª–µ–º–∞ —É —Ñ—ñ—á—ñ: " + feature;

    const text =
`–§—ñ—á–∞: ${feature}
–§–∞–π–ª: ${file}
–§—É–Ω–∫—Ü—ñ—è: ${func || "–Ω–µ –≤–∫–∞–∑–∞–Ω–æ"}

–û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏:
${details}

–©–æ —Ç—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏:
(–¥–æ–ø–∏—à–∏ —Å–≤–æ—é –∑–∞–¥–∞—á—É —ñ –≤—ñ–¥–ø—Ä–∞–≤ –º–µ–Ω—ñ —Ü–µ–π —Ç–µ–∫—Å—Ç —É —á–∞—Ç)
`;

    document.getElementById("pd-text").textContent = text;
    document.getElementById("problem-detail").style.display = "block";
  });
});
</script>

{% endblock %}
