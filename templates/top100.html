<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Top-100 PXP</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<style>
  .page { max-width: 1100px; margin: 0 auto; padding: 20px; }
  h1 { margin-bottom: 18px; color: var(--ink); }

  /* —Ç–≤—ñ–π —Å—Ç–∏–ª—å —Ç–∞–±–ª–∏—Ü—ñ ‚Äî –∑–∞—Å—Ç–æ—Å—É—î–º–æ –¥–æ —Ç–∞–±–ª–∏—Ü—ñ –≤ .table-wrap, —â–æ–± –Ω–µ –º—ñ–Ω—è—Ç–∏ —Ä–æ–∑–º—ñ—Ç–∫—É */
  .table-wrap table {
    width: 100%;
    border-collapse: collapse;
    border-radius: 12px;
    overflow: hidden;
    background: color-mix(in srgb, var(--card) 96%, #000 4%);
    box-shadow: 0 8px 24px rgba(0,0,0,.25);
  }
  .table-wrap th, .table-wrap td {
    padding: 12px 14px;
    text-align: left;
    border-top: 1px solid var(--line);
    color: var(--ink);
  }
  .table-wrap th {
    background: color-mix(in srgb, var(--card) 90%, #000 10%);
    font-weight: 700;
    color: var(--muted);
  }
  .table-wrap tr:nth-child(even) {
    background: color-mix(in srgb, var(--card) 92%, #000 8%);
  }
  .table-wrap tr:hover {
    background: color-mix(in srgb, var(--btn-bg) 15%, var(--card) 85%);
  }

  .rank { font-weight: 700; color: var(--btn-bg); }
  .pxp  { font-weight: 600; color: var(--btn-text-hover); }

  /* –ª–µ–≥–∫—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –ø–∞–Ω–µ–ª–µ–π/–±–µ–π–¥–∂—ñ–≤ */
  .panel{ background: color-mix(in srgb, var(--card) 96%, #000 4%); border:1px solid var(--line);
          border-radius:16px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.25); }
  .sub{ color:var(--muted) }
  .btn{ display:inline-block; padding:10px 14px; background:var(--btn-bg); color:var(--btn-text);
        border-radius:10px; text-decoration:none; font-weight:700; }
  .btn:hover{ color:var(--btn-text-hover); }

  /* hero —Å–µ–∫—Ü—ñ—è Top-1 */
  .hero{ display:grid; grid-template-columns:56px 1fr auto auto; gap:14px; align-items:center; }
  .hero .ava{ width:56px; height:56px; border-radius:12px; background:#222a; border:1px solid var(--line); }
  .hero .name{ font-weight:800; color:var(--ink); font-size:1.15rem }
  .hero .stats{ display:flex; gap:12px; color:var(--muted) }
  .badge{ background:#1d4ed8; color:#fff; padding:8px 12px; border-radius:10px; font-weight:800 }
  .medal{ margin-right:6px }

  /* skeletons –¥–ª—è —Å—Ç–∞–Ω—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
  .skeleton{ position:relative; overflow:hidden; background: color-mix(in srgb, var(--card) 86%, #000 14%); border-radius:8px; }
  .skeleton::after{
    content:""; position:absolute; inset:0; transform:translateX(-100%);
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent);
    animation: shimmer 1.25s infinite;
  }
  @keyframes shimmer{ 100% { transform:translateX(100%); } }
  .sk-a{ width:36px; height:36px; border-radius:10px; background:#1b2233 }
  .sk-n{ width:160px; height:14px }
  .sk-b{ width:40px; height:14px }
  .sk-l{ width:120px; height:14px }

  .tabs .tab.active{ background: color-mix(in srgb, var(--btn-bg) 35%, #1a1f2e 65%); border-color: var(--btn-bg); color:#fff; }
  .note{ color:var(--muted) }
</style>

</head>
<body>
  {% include 'nav.html' %}

  <div class="page">
    <h1>Top-100 PXP</h1>
    <div class="sub">–†–µ–π—Ç–∏–Ω–≥ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é <b>PXP</b>. –û–±–µ—Ä–∏ –ø–µ—Ä—ñ–æ–¥.</div>

    <div class="panel" id="heroPanel" style="display:none; margin-bottom:14px;">
      <div class="hero">
        <div id="heroAva" class="ava"></div>
        <div class="meta">
          <div class="name" id="heroName">‚Äî</div>
          <div class="stats">
            <span id="heroPxp">PXP: ‚Äî</span>
            <span id="heroDate">–ó –Ω–∞–º–∏ –∑: ‚Äî</span>
          </div>
        </div>
        <a id="heroBtn" href="{{ url_for('profile.profile') }}" class="btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</a>
        <div class="badge"><span class="medal">ü•á</span> –¢–æ–ø-1</div>
      </div>
    </div>

    <div class="panel">
      <div class="toolbar" style="display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:12px;">
        <div class="tabs" id="tabs" style="display:flex; gap:8px;">
          <button class="tab active" data-range="all" style="padding:8px 12px; border-radius:10px; background:#1a1f2e; border:1px solid #25304b; cursor:pointer; font-weight:600;">–ó–∞ –≤–µ—Å—å —á–∞—Å</button>
          <button class="tab" data-range="month" style="padding:8px 12px; border-radius:10px; background:#1a1f2e; border:1px solid #25304b; cursor:pointer; font-weight:600;">–ú—ñ—Å—è—Ü—å</button>
          <button class="tab" data-range="week" style="padding:8px 12px; border-radius:10px; background:#1a1f2e; border:1px solid #25304b; cursor:pointer; font-weight:600;">–¢–∏–∂–¥–µ–Ω—å</button>
        </div>
        <div class="sub">PXP = PixPaw üêæ</div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr><th class="rank">#</th><th>–ù—ñ–∫</th><th>PXP</th><th>–ó –Ω–∞–º–∏ –∑</th></tr>
          </thead>
          <tbody id="tbody">
            <tr class="sk-row"><td><div class="skeleton sk-b"></div></td><td><div style="display:flex;align-items:center;gap:10px;"><div class="sk-a"></div><div class="skeleton sk-n"></div></div></td><td><div class="skeleton sk-b"></div></td><td><div class="skeleton sk-l"></div></td></tr>
            <tr class="sk-row"><td><div class="skeleton sk-b"></div></td><td><div style="display:flex;align-items:center;gap:10px;"><div class="sk-a"></div><div class="skeleton sk-n"></div></div></td><td><div class="skeleton sk-b"></div></td><td><div class="skeleton sk-l"></div></td></tr>
            <tr class="sk-row"><td><div class="skeleton sk-b"></div></td><td><div style="display:flex;align-items:center;gap:10px;"><div class="sk-a"></div><div class="skeleton sk-n"></div></div></td><td><div class="skeleton sk-b"></div></td><td><div class="skeleton sk-l"></div></td></tr>
          </tbody>
        </table>
      </div>

      <div id="myrank" class="note" style="margin-top:12px"></div>
      <div class="note">–©–æ–± —É–≤—ñ–π—Ç–∏ –¥–æ –¢–û–ü-100, –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ –±—ñ–ª—å—à–µ PXP, –Ω—ñ–∂ —É 100-–≥–æ –º—ñ—Å—Ü—è. 1$ = 1 PXP.</div>
    </div>
  </div>

  <script>
    const API = '/api/pxp/top100';   // –±–µ–∫–µ–Ω–¥: –ø—Ä–∏–π–º–∞—î ?period=all|month|week

    function formatSince(dateStr) {
      // —è–∫—â–æ –¥–æ–¥–∞—Å–∏ created_at ‚Äî –≤—ñ–¥—Ñ–æ—Ä–º–∞—Ç—É–π —Ç—É—Ç
      return dateStr ? new Date(dateStr).toLocaleDateString() : '‚Äî';
    }

    function normalize(data){
      // –ü—ñ–¥—Ç—Ä–∏–º—É—î–º–æ —ñ –º–∞—Å–∏–≤, —ñ –æ–±'—î–∫—Ç {items:[...], me_rank, me_pxp}
      if (Array.isArray(data)) return { items: data, me_rank: null, me_pxp: null };
      if (data && Array.isArray(data.items)) return data;
      return { items: [], me_rank: null, me_pxp: null };
    }

    function showSkeleton(){
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = `
        <tr class="sk-row"><td><div class="skeleton sk-b"></div></td><td><div style="display:flex;align-items:center;gap:10px;"><div class="sk-a"></div><div class="skeleton sk-n"></div></div></td><td><div class="skeleton sk-b"></div></td><td><div class="skeleton sk-l"></div></td></tr>
        <tr class="sk-row"><td><div class="skeleton sk-b"></div></td><td><div style="display:flex;align-items:center;gap:10px;"><div class="sk-a"></div><div class="skeleton sk-n"></div></div></td><td><div class="skeleton sk-b"></div></td><td><div class="skeleton sk-l"></div></td></tr>
        <tr class="sk-row"><td><div class="skeleton sk-b"></div></td><td><div style="display:flex;align-items:center;gap:10px;"><div class="sk-a"></div><div class="skeleton sk-n"></div></div></td><td><div class="skeleton sk-b"></div></td><td><div class="skeleton sk-l"></div></td></tr>
      `;
    }

    function renderRows(list) {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '';
      if (!list.length) {
        tbody.innerHTML = `<tr><td colspan="4" class="sub">–©–µ –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö</td></tr>`;
        return;
      }
      list.forEach((u, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="rank">${i + 1}</td>
          <td>
            <div style="display:flex;align-items:center;gap:10px;">
              <div class="ava" style="width:36px;height:36px;border-radius:10px;background:#1b2233;border:1px solid var(--line);"></div>
              <span>${(u.name || (u.email ? u.email.split('@')[0] : '–ë–µ–∑ —ñ–º–µ–Ω—ñ'))}</span>
            </div>
          </td>
          <td class="pxp">${u.pxp}</td>
          <td>${formatSince(u.created_at)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderHero(list) {
      const hero = document.getElementById('heroPanel');
      if (!list.length) { hero.style.display='none'; return; }
      const top = list[0];
      document.getElementById('heroName').textContent = top.name || '–ë–µ–∑ —ñ–º–µ–Ω—ñ';
      document.getElementById('heroPxp').textContent  = `PXP: ${top.pxp}`;
      document.getElementById('heroDate').textContent = `–ó –Ω–∞–º–∏ –∑: ${formatSince(top.created_at)}`;
      hero.style.display = 'block';
    }

    function renderMyRank(me_rank, me_pxp){
      const n = document.getElementById('myrank');
      if (me_rank == null) { n.textContent = ''; return; }
      n.textContent = `–¢–≤—ñ–π —Ä–∞–Ω–≥: #${me_rank} ‚Ä¢ PXP: ${me_pxp}`;
    }

    async function load(period='all'){
      showSkeleton();
      const url = `${API}?period=${encodeURIComponent(period)}`;
      try{
        const r = await fetch(url, {headers:{'Accept':'application/json'}});
        if(!r.ok) throw new Error(`HTTP ${r.status}`);
        const raw = await r.json();
        const data = normalize(raw);
        renderRows(data.items);
        renderHero(data.items);
        renderMyRank(data.me_rank, data.me_pxp);
      }catch(err){
        console.error(err);
        const tbody = document.getElementById('tbody');
        tbody.innerHTML = `<tr><td colspan="4">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</td></tr>`;
        renderMyRank(null, null);
        document.getElementById('heroPanel').style.display='none';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // —Å—Ç–∞—Ä—Ç ‚Äî "–ó–∞ –≤–µ—Å—å —á–∞—Å"
      load('all');

      // —Ç–∞–±–∏
      const tabs = document.querySelectorAll('#tabs .tab');
      tabs.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          tabs.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const p = btn.getAttribute('data-range') || 'all';
          load(p);
        });
      });
    });
  </script>
</body>
</html>
