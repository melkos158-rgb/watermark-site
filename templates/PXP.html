<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ü—Ä–æ—Ñ—ñ–ª—å ‚Äî PXP</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body{background:#0f1115;color:#e8eaed;margin:0}
    .page{max-width:980px;margin:0 auto;padding:16px 24px 40px}
    .panel{background:#11141b;border:1px solid #1d2230;border-radius:16px;padding:18px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .row{display:flex;gap:20px;flex-wrap:wrap}
    .left{flex:0 0 260px}
    .right{flex:1}
    h1{margin:10px 0 16px;font-size:22px}
    .muted{color:#9fb0d4}

    /* avatar */
    .avatar-wrap{position:relative;width:200px;height:200px;margin:6px auto 10px}
    .avatar{width:100%;height:100%;border-radius:50%;object-fit:cover;background:#1a2033;border:2px solid #1d2230}
    .edit-btn{position:absolute;right:8px;bottom:8px;background:#1c64ec;border:0;color:#fff;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 8px 18px rgba(28,100,236,.35)}
    .edit-btn:hover{filter:brightness(.95)}
    .edit-btn span{font-size:20px;line-height:1}
    input[type="file"]{display:none}

    .field{margin-bottom:14px}
    .label{font-size:12px;color:#9fb0d4;margin-bottom:6px}
    .input, .textarea{
      width:100%;background:#0f131c;border:1px solid #1b2131;color:#e8eaed;
      border-radius:10px;padding:10px 12px;outline:none
    }
    .textarea{min-height:110px;resize:vertical}
    .btn{display:inline-block;padding:10px 16px;background:#1c64ec;color:#fff;font-weight:700;border-radius:10px;text-decoration:none;border:0;cursor:pointer}
    .btn:hover{filter:brightness(.95)}
    .btn.gray{background:#23293a;color:#dbe5ff}

    .stat{display:flex;gap:18px;align-items:center;margin:8px 0 18px}
    .badge{background:#0f131c;border:1px solid #1b2131;border-radius:10px;padding:8px 10px}
  </style>
</head>
<body>
  <!-- NAV -->
  {% include 'nav.html' %}

  <div class="page">
    <h1>–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</h1>
    <div class="panel">
      <div class="row">
        <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: –∞–≤–∞—Ç–∞—Ä -->
        <div class="left">
          <div class="avatar-wrap">
            {% set initial_avatar = (current_user.avatar if current_user and current_user.avatar else url_for('static', filename='avatar_default.png')) %}
            <img id="avatar" class="avatar" src="{{ initial_avatar }}" alt="avatar">
            <button class="edit-btn" id="editAvatar" title="–ó–º—ñ–Ω–∏—Ç–∏ –∞–≤–∞—Ç–∞—Ä"><span>‚úé</span></button>
            <input id="avatarInput" type="file" accept="image/*">
          </div>
          <div class="stat">
            <div class="badge">üí∞ PXP: <b id="pxpHeader">{{ (current_user.pxp if current_user else balance) or 0 }}</b></div>
            <a href="{{ url_for('profile.top100') }}" class="btn gray">–¢–æ–ø-100</a>
          </div>
          <a href="/donate" class="btn" style="width:100%;text-align:center">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ PXP</a>
          <div class="muted" style="margin-top:8px">1$ = 1 PXP</div>
        </div>

        <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: —ñ–º'—è, –æ–ø–∏—Å -->
        <div class="right">
          <div class="field">
            <div class="label">–Ü–º‚Äô—è / –Ω—ñ–∫</div>
            <input id="name" class="input" type="text" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ—î —ñ–º‚Äô—è"
                   value="{{ (current_user.name if current_user and current_user.name else '') }}">
          </div>
          <div class="field">
            <div class="label">–û–ø–∏—Å –ø—Ä–æ —Å–µ–±–µ</div>
            <textarea id="bio" class="textarea" placeholder="–ö—ñ–ª—å–∫–∞ —Å–ª—ñ–≤ –ø—Ä–æ —Å–µ–±–µ, —á–∏–º –∑–∞–π–º–∞—î—à—Å—è, —â–æ –ª—é–±–∏—à üôÇ">{{ (current_user.bio if current_user and current_user.bio else '') }}</textarea>
          </div>
          <button id="save" class="btn">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          <button id="reset" class="btn gray" style="margin-left:8px">–°–∫–∏–Ω—É—Ç–∏</button>
          <div id="msg" class="muted" style="margin-top:10px"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===== –õ–æ–∫–∞–ª—å–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–±–µ–∑ –±–µ–∫–µ–Ω–¥–∞) =====
  const nameEl = document.getElementById('name');
  const bioEl  = document.getElementById('bio');
  const msgEl  = document.getElementById('msg');
  const avatarImg = document.getElementById('avatar');
  const avatarInput = document.getElementById('avatarInput');
  const editBtn = document.getElementById('editAvatar');

  // –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ localStorage, —è–∫—â–æ —î —â–æ—Å—å –∑–±–µ—Ä–µ–∂–µ–Ω–µ —Ä–∞–Ω—ñ—à–µ
  (function loadProfile(){
    try{
      const p = JSON.parse(localStorage.getItem('profile') || '{}');
      if (p.name) nameEl.value = p.name;
      if (p.bio)  bioEl.value  = p.bio;
      if (p.avatarDataUrl) avatarImg.src = p.avatarDataUrl;
    }catch(e){ /* ignore */ }
  })();

  // –∑–±–µ—Ä–µ–≥—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ
  document.getElementById('save').addEventListener('click', ()=>{
    const data = {
      name: nameEl.value.trim(),
      bio: bioEl.value.trim(),
      avatarDataUrl: avatarImg.src
    };
    localStorage.setItem('profile', JSON.stringify(data));
    msgEl.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ ‚úÖ';
    setTimeout(()=> msgEl.textContent='', 2000);
  });

  // —Å–∫–∏–Ω—É—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ
  document.getElementById('reset').addEventListener('click', ()=>{
    localStorage.removeItem('profile');
    nameEl.value = '';
    bioEl.value = '';
    // –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –¥–µ—Ñ–æ–ª—Ç–Ω–∏–π/—Å–µ—Ä–≤–µ—Ä–Ω–∏–π –∞–≤–∞—Ç–∞—Ä
    avatarImg.src = "{{ initial_avatar }}";
    msgEl.textContent = '–°–∫–∏–Ω—É—Ç–æ ‚ùå';
    setTimeout(()=> msgEl.textContent='', 2000);
  });

  // –∑–º—ñ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ (—ñ–∫–æ–Ω–∫–∞-–æ–ª—ñ–≤–µ—Ü—å –≤—ñ–¥–∫—Ä–∏–≤–∞—î –≤–∏–±—ñ—Ä —Ñ–∞–π–ª—É)
  editBtn.addEventListener('click', ()=> avatarInput.click());
  avatarInput.addEventListener('change', (e)=>{
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    const reader = new FileReader();
    reader.onload = ev => { avatarImg.src = ev.target.result; };
    reader.readAsDataURL(f);
  });
</script>
</body>
</html>
