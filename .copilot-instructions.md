# Proofly Copilot Instructions (Production Rules)

You are working in a production Flask marketplace called Proofly.

## Golden rules
- Do NOT invent new models, routes, tables, or env vars.
- Prefer minimal diffs. Never rewrite whole files unless explicitly asked.
- Root cause first: explain what fails, where, and why. Then propose the smallest fix.
- Keep backward compatibility with existing URLs and templates.

## Backend (Flask)
- Use existing blueprints and route prefixes.
- API endpoints must return JSON only (no redirects).
- Validate inputs; return proper HTTP codes (400/401/403/404/409/500).
- Never introduce breaking changes in request/response shape.
- Prefer extending existing utilities over new abstractions.

## Auth
- If endpoint is API: unauthenticated -> 401 JSON.
- Never redirect to login from API routes.
- If using Flask-Login, check `current_user.is_authenticated`.

## Market domain expectations
- Items have images, STL, and sometimes videos.
- Cover image must never show “No image” if any image exists.
- Marketplace pages must render fast; avoid N+1 queries.

## Frontend (Templates/JS)
- No inline JS in templates (unless the file already uses it).
- Prefer attaching listeners via delegated events.
- Keep UX stable: no full page reload for favorite/save actions.
- Use existing CSS variables and utility classes.

## Logging / Debug
- Add safe logs only if needed (avoid secrets).
- Prefer `current_app.logger` over print.

## Deliverables for each change
When proposing a fix, always provide:
1) cause
2) exact files + functions to change
3) minimal patch plan
4) expected result after deploy
